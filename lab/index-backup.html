<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WeatherWise Color Lab</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

<style>
.container {
  max-width: 1500px;
  margin: 0 auto;
  padding: 40px 30px;
}

  
body{
  margin:0;
  background:#0d1117;
  color:#e6edf3;
  font-family:'JetBrains Mono', monospace;
  padding:40px;
}

h1{
  text-align:center;
  margin-bottom:30px;
}

.preview{
  height:40px;
  border:1px solid #38bdf8;
  border-radius:8px;
  margin-bottom:30px;
  background:
    repeating-linear-gradient(45deg,#111 0 10px,#1a1a1a 10px 20px);
}

.meta{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:10px;
  margin-bottom:30px;
}

input,select{
  background:#111827;
  border:1px solid #1f2937;
  color:#e6edf3;
  padding:8px;
  border-radius:6px;
  font-family:'JetBrains Mono', monospace;
}

input[type="color"]{
  -webkit-appearance: none;
  appearance: none;
  width: 40px;
  height: 32px;
  padding: 0;
  border: none;
  background: none;
  cursor: pointer;
}

input[type="color"]::-webkit-color-swatch-wrapper{
  padding: 0;
}

input[type="color"]::-webkit-color-swatch{
  border: 1px solid #1f2937;
  border-radius: 4px;
}


.rows{
  display:flex;
  flex-direction:column;
  gap:14px;
}

.row{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  align-items:center;
  background:#111827;
  padding:10px;
  border-radius:8px;
}

.color-set{
  display:flex;
  gap:6px;
  align-items:center;
}

.color-set input[type="number"]{
  width:55px;
}

.color-set input.hex{
  width:85px;
  text-transform:uppercase;
}

button{
  background:#2563eb;
  border:none;
  color:white;
  padding:10px 16px;
  border-radius:6px;
  cursor:pointer;
}

button:hover{
  background:#1d4ed8;
}

.controls{
  margin-top:25px;
  display:flex;
  gap:10px;
}


.delete-btn {
  background: #1f2937;
  border: 1px solid #374151;
  color: #94a3b8;
  padding: 6px;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: 0.15s ease;
}

.delete-btn:hover {
  background: #7f1d1d;
  border-color: #991b1b;
  color: #fff;
}

.delete-btn svg {
  pointer-events: none;
}



</style>
</head>
<body>
<div class="container">

<h1>WeatherWise Color Lab</h1>

<div id="preview" class="preview"></div>

<div class="meta">
  <input id="product" placeholder="Product (BR)">
  <input id="units" placeholder="Units (dBZ)">
  <input id="scale" placeholder="Scale">
  <input id="offset" placeholder="Offset">
  <input id="step" placeholder="Step">
</div>

<div id="rows" class="rows"></div>

<div class="controls">
  <button onclick="addRow()">Add Row</button>
  <button onclick="downloadPAL()">Download .PAL</button>
</div>


<script>
const rowsContainer=document.getElementById("rows");

const preview=document.getElementById("preview");

const defaultTable = [
  { value: 0,   type: "color",  start: {r:0,g:215,b:130} },
  { value: 10,  type: "color",  start: {r:0,g:215,b:130}, end:{r:0,g:75,b:0} },
  { value: 35,  type: "color",  start: {r:255,g:255,b:33} },
  { value: 42,  type: "color",  start: {r:255,g:155,b:0} },
  { value: 45,  type: "color",  start: {r:255,g:0,b:0}, end:{r:150,g:0,b:0} },
  { value: 55,  type: "color",  start: {r:175,g:0,b:150} },
  { value: 60,  type: "color",  start: {r:230,g:100,b:230} },
  { value: 70,  type: "solid",  start: {r:0,g:0,b:0} },
  { value: 90,  type: "solid",  start: {r:255,g:255,b:255} }
];


function rgbToHex(r,g,b){
  return "#"+[r,g,b].map(x=>{
    const h=parseInt(x).toString(16);
    return h.length===1?"0"+h:h;
  }).join("");
}

function hexToRgb(hex){
  const result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result?{
    r:parseInt(result[1],16),
    g:parseInt(result[2],16),
    b:parseInt(result[3],16)
  }:null;
}

function createColorSet(container,data,withAlpha=false){
  container.innerHTML=`
    <input type="color" class="picker">
    <input type="text" class="hex">
    <input type="number" class="r" min="0" max="255">
    <input type="number" class="g" min="0" max="255">
    <input type="number" class="b" min="0" max="255">
    ${withAlpha ? '<input type="number" class="a" min="0" max="255">' : ''}
  `;

  const picker=container.querySelector(".picker");
  const hexInput=container.querySelector(".hex");
  const rInput=container.querySelector(".r");
  const gInput=container.querySelector(".g");
  const bInput=container.querySelector(".b");
  const aInput=container.querySelector(".a");

  function syncFromRGB(){
    const hex=rgbToHex(rInput.value,gInput.value,bInput.value);
    picker.value=hex;
    hexInput.value=hex;
  }

  function syncFromHEX(){
    const rgb=hexToRgb(hexInput.value);
    if(rgb){
      rInput.value=rgb.r;
      gInput.value=rgb.g;
      bInput.value=rgb.b;
      picker.value=hexInput.value;
    }
  }

  rInput.value=data.r;
  gInput.value=data.g;
  bInput.value=data.b;
  if(aInput) aInput.value=data.a ?? 255;
  syncFromRGB();

  picker.addEventListener("input",()=>{
    const rgb=hexToRgb(picker.value);
    rInput.value=rgb.r;
    gInput.value=rgb.g;
    bInput.value=rgb.b;
    hexInput.value=picker.value;
    updatePreview();
  });

  container.addEventListener("input",e=>{
    if(e.target.classList.contains("r")||
       e.target.classList.contains("g")||
       e.target.classList.contains("b")||
       e.target.classList.contains("a")){
      syncFromRGB();
      updatePreview();
    }
  });

  hexInput.addEventListener("input",()=>{
    if(/^#([0-9A-F]{6})$/i.test(hexInput.value)){
      syncFromHEX();
      updatePreview();
    }
  });
}


function addRow(data){
  const row=document.createElement("div");
  row.className="row";

  row.innerHTML=`
    <input type="number" class="value" placeholder="Value">
    <select class="mode">
      <option value="color" selected>Color</option>
      <option value="solid">Solid</option>
      <option value="color4">Color4</option>
      <option value="solid4">Solid4</option>
    </select>
  `;


  const valueInput=row.querySelector(".value");
  const modeSelect=row.querySelector(".mode");

  if(data){
    valueInput.value=data.value;
    modeSelect.value=data.type;
  }

  // START COLOR SET
  const startSet=document.createElement("div");
  startSet.className="color-set";
  createColorSet(startSet,data?data.start:{r:0,g:215,b:130,a:255});
  row.appendChild(startSet);

  // USE END CHECKBOX (RIGHT AFTER START COLOR)
  const endWrapper=document.createElement("label");
  endWrapper.style.display="flex";
  endWrapper.style.alignItems="center";
  endWrapper.style.gap="6px";
  endWrapper.style.marginLeft="10px";

  const endToggle=document.createElement("input");
  endToggle.type="checkbox";
  endToggle.className="useEnd";

  const endText=document.createElement("span");
  endText.textContent="End";

  endWrapper.appendChild(endToggle);
  endWrapper.appendChild(endText);

  row.appendChild(endWrapper);

  // END COLOR SET (INLINE, HIDDEN BY DEFAULT)
  const endSet=document.createElement("div");
  endSet.className="color-set";
  endSet.style.display="none";
  createColorSet(endSet,data?.end || {r:255,g:0,b:0,a:255});
  row.appendChild(endSet);

  if(data?.end) endToggle.checked=true;

  function updateVisibility(){
    const mode=modeSelect.value;

    const allowsEnd = (mode==="color" || mode==="color4");

    endWrapper.style.display = allowsEnd ? "flex" : "none";

    if(allowsEnd && endToggle.checked){
      endSet.style.display="flex";
    } else {
      endSet.style.display="none";
    }

    updatePreview();
  }

  modeSelect.addEventListener("change",updateVisibility);
  endToggle.addEventListener("change",updateVisibility);
  row.addEventListener("input",updatePreview);

// DELETE BUTTON
const deleteBtn = document.createElement("button");
deleteBtn.className = "delete-btn";
deleteBtn.innerHTML = `
<svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
  <polyline points="3 6 5 6 21 6"/>
  <path d="M19 6l-1 14H6L5 6"/>
  <path d="M10 11v6"/>
  <path d="M14 11v6"/>
  <path d="M9 6V4h6v2"/>
</svg>
`;

deleteBtn.addEventListener("click", () => {
  const allRows = document.querySelectorAll(".row");
  if (allRows.length <= 1) return;
  row.remove();
  updatePreview();
});

row.appendChild(deleteBtn);




  rowsContainer.appendChild(row);
  updateVisibility();
}


function updatePreview(){
  const rows=[...document.querySelectorAll(".row")];
  if(rows.length===0) return;

rows.sort((a,b)=>{
  return (parseFloat(a.querySelector(".value").value)||0) -
         (parseFloat(b.querySelector(".value").value)||0);
});

// ðŸ”¥ Visually reorder rows
rows.forEach(row => rowsContainer.appendChild(row));


  const values=rows.map(r=>parseFloat(r.querySelector(".value").value)||0);
  const min=Math.min(...values);
  const max=Math.max(...values);
  const range = max - min || 1;

  let stops=[];

  for(let i=0;i<rows.length;i++){

    const row = rows[i];
    const value = parseFloat(row.querySelector(".value").value)||0;
    const percent = ((value-min)/range)*100;

    const mode = row.querySelector(".mode").value;
    const useEnd = row.querySelector(".useEnd")?.checked;

    const sets = row.querySelectorAll(".color-set");
    const startSet = sets[0];
    const endSet = sets[1];

    const r = startSet.querySelector(".r").value;
    const g = startSet.querySelector(".g").value;
    const b = startSet.querySelector(".b").value;
    const a = startSet.querySelector(".a")?.value ?? 255;

    const startColor = mode.includes("4")
      ? `rgba(${r},${g},${b},${a/255})`
      : `rgb(${r},${g},${b})`;

    // Always push starting stop
    stops.push(`${startColor} ${percent}%`);

    // If last row, stop here
    if(i === rows.length-1) break;

    const nextRow = rows[i+1];
    const nextValue = parseFloat(nextRow.querySelector(".value").value)||0;
    const nextPercent = ((nextValue-min)/range)*100;

    if(mode === "color" || mode === "color4"){
      if(useEnd && endSet){

        const r2 = endSet.querySelector(".r").value;
        const g2 = endSet.querySelector(".g").value;
        const b2 = endSet.querySelector(".b").value;
        const a2 = endSet.querySelector(".a")?.value ?? 255;

        const endColor = mode === "color4"
          ? `rgba(${r2},${g2},${b2},${a2/255})`
          : `rgb(${r2},${g2},${b2})`;

        stops.push(`${endColor} ${nextPercent}%`);
      }
      else{
        // Blend into next rowâ€™s start color naturally
        continue;
      }
    }

    if(mode === "solid" || mode === "solid4"){
      stops.push(`${startColor} ${nextPercent}%`);
    }
  }

  preview.style.background = `linear-gradient(to right, ${stops.join(",")})`;
}


function downloadPAL(){
  const rows=[...document.querySelectorAll(".row")];

  // ðŸ”¥ Sort rows by value before export
  rows.sort((a,b)=>{
    return (parseFloat(a.querySelector(".value").value)||0) -
           (parseFloat(b.querySelector(".value").value)||0);
  });

  let content="";

  rows.forEach(row=>{
    const val=row.querySelector(".value").value;
    const mode=row.querySelector(".mode").value;

    const sets = row.querySelectorAll(".color-set");
    const start = sets[0];
    const end = sets[1];

    const r=start.querySelector(".r").value;
    const g=start.querySelector(".g").value;
    const b=start.querySelector(".b").value;
    const a=start.querySelector(".a")?.value;

    const useEnd = row.querySelector(".useEnd")?.checked;

    if(mode==="solid"){
      content+=`SolidColor: ${val} ${r} ${g} ${b}\n`;
    }

    if(mode==="solid4"){
      content+=`SolidColor4: ${val} ${r} ${g} ${b} ${a}\n`;
    }

    if(mode==="color"){
      content+=`Color: ${val} ${r} ${g} ${b}`;
      if(useEnd && end){
        const r2=end.querySelector(".r").value;
        const g2=end.querySelector(".g").value;
        const b2=end.querySelector(".b").value;
        content+=` ${r2} ${g2} ${b2}`;
      }
      content+="\n";
    }

    if(mode==="color4"){
      content+=`Color4: ${val} ${r} ${g} ${b} ${a}`;
      if(useEnd && end){
        const r2=end.querySelector(".r").value;
        const g2=end.querySelector(".g").value;
        const b2=end.querySelector(".b").value;
        const a2=end.querySelector(".a")?.value ?? 255;
        content+=` ${r2} ${g2} ${b2} ${a2}`;
      }
      content+="\n";
    }
  });

  const blob=new Blob([content],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="colortable.pal";
  a.click();
}


// Load default table on startup
defaultTable.forEach(row => addRow(row));
updatePreview();

</script>
</div>
</body>
</html>
